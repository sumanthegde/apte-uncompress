module SandhiTest where
import Sandhi
import Utils
import Control.Monad (forM)

-- To keep resemblance with the SandhiVTest module, the same data format is continued
-- (with commenting out a few data points that don't apply here for whatever reasons)
-- And the sandhi function views the data "inversely". 
-- uttarapada's were the 'expected ones' before; they're part of input now
-- Similarly fulls were in input before; they're the expected ones now
akData = [
    ("अ","आलयः",["अलयः","आलयः"])
  , ("आ","आलयः",["लयः","अलयः","आलयः"])
  --, ("अ","अआलयः",["आलयः"]) --   Allowed, for simplicity. TODO: Restrict it to likes of ""+"गतः", "प्र"+"गतः", "देव"+"ऋषिः"
  , ("देव","देवालयः",["अलयः","आलयः"])
  , ("श्री","श्रीशः",["शः","इशः","ईशः"])
  , ("होतृ","होतॄकारः",["ऋकारः","ॠकारः"])
  , ("देव","देवेशः", ["इशः","ईशः"])
  , ("महा","महेशः",["इशः","ईशः"])
  , ("देव","देवर्षिः",["र्षिः","ऋषिः","ॠषिः"])
  , ("महा","महर्षिः",["ऋषिः","ॠषिः"])
  , ("प्र","प्रार्च्छन्",["ऋच्छन्","अर्च्छन्","आर्च्छन्"]) 
  , ("आ","आर्च्छन्",["र्च्छन्","ऋच्छन्","अर्च्छन्","आर्च्छन्"]) 
  --, ("देव","देवार्षिः",["ऋषिः","अर्षिः","आर्षिः"])  -- TODO: Don't allow vRddhi here
  , ("देव","देवैकत्वम्",["एकत्वम्","ऐकत्वम्"])
  , ("देव","देवौषधः",["ओषधः","औषधः"])
  , ("अति","अत्यन्तम्",["अन्तम्"])
  , ("गुरु","गुर्वाज्ञा",["आज्ञा"])
  , ("मातृ","मात्रंशः",["अंशः"])
  , ("देव","देवव्रतः", ["व्रतः"])
  , ("अ","अदयः",["दयः"])
  , ("देवे","देवेकः",["कः"])
  , ("नै","नैक्यम्",["क्यम्"])
  , ("सोम","सोमरसः",["रसः"])
  , ("अति","अतिशयः",["शयः"])
  , ("प्र", "प्रार्च्छन्", [ "ऋच्छन्" ]) 
  , ("प्र", "प्रेषणम्", [ "एषणम्" ]) 
  , ("के", "केचित्", ["चित्"])
  ]
ecData = [
  ("देवे","देवेऽपि",["ऽपि","अपि"])
  , ("देवै","देवायपि",["अपि"])
--  , ("देवे","देवइति",["इति"])
  , ("देवे","देवयिति",["इति"])
--  , ("देवौ","देवाइति",["इति"])
  , ("देवौ","देवाविति",["इति"])
  ]
acDataNeg = [
    ("आ","अदयः",[])
  , ("देव","शिवालयः",[])
  , ("अति","अत्वन्तम्",[])
  , ("हरि","हर्यीशः",[])
  , ("देवे","देवैकः",[])
  , ("देवे","देवयपि",[])
  ]
  {-
    [true,["देवः","देवस्तरति",["स्तरति","तरति"],["देवःस्तरति","देवस्तरति"]]]
    [true,["देवः","देवस्सीदति",["स्सीदति","सीदति"],["देवःसीदति","देवःस्सीदति"]]]
    [true,["दुः","दुस्खलः",["स्खलः"],["दुःस्खलः"]]]
    [true,["दुः","दुस्करः",["स्करः"],["दुःस्करः"]]]
    [true,["दुः","दुस्स्करः",["स्स्करः","स्करः"],["दुःस्करः","दुःस्स्करः"]]]
    [true,["दुः","दुस्तरः",["स्तरः","तरः"],["दुःस्तरः","दुस्तरः"]]]
    [true,["दुः","दुष्करः",["करः"],["दुःकरः"]]]
    [true,["निः","निष्फल",["फल"],["निःफल"]]]
    [true,["देवः","देवश्शयितः",["शयितः"],["देवःशयितः"]]]
    [true,["देवः","देवष्षष्ठः",["षष्ठः"],["देवःषष्ठः"]]]
    [true,["गुरुः","गुरुस्साक्षात्",["स्साक्षात्","साक्षात्"],["गुरुःसाक्षात्","गुरुःस्साक्षात्"]]]
    [
  -}
visargaData = [
    ("देवः","देवोऽपि",["अपि"])
  , ("देवः","देवउत",["उत"])
  , ("देवः","देवोरक्षति",["रक्षति"])
  , ("देवः","देवोगच्छति",["गच्छति"])
  , ("देवः","देवस्तरति",["तरति"])
  , ("देवः","देवःसीदति",["सीदति"]) 
  , ("दुः","दुःशला",["शला"])  
  , ("दुः","दुःसाहः",["साहः"])
  , ("दुः","दुःषमम्",["षमम्"])  -- TODO: also allow समम्, due to कूलतीरतूलमूलशालाऽक्षसममव्ययीभावे (needs careful षत्व impl?)
  , ("दुः","दुःस्खलः",["स्खलः"])
  , ("दुः","दुःस्करः",["स्करः"]) 
  , ("दुः","दुस्तरः",["तरः"])
  , ("दुः","दुष्करः",["करः"])
  , ("निः","निष्फल",["फल"])
  , ("देवः","देवःशयितः",["शयितः"])
  , ("देवः","देवश्चिनोति",["चिनोति"])
  , ("देवः","देवष्टीकते",["टीकते"])
  , ("देवः","देवःषष्ठः",["षष्ठः"])
  , ("देवाः","देवाआगताः",["आगताः"])
  , ("देवाः","देवाइति",["इति"])
  , ("देवाः","देवागताः",["गताः"])
  , ("हरिः","हरिरपि",["अपि"])
  , ("हरिः","हरीरपि",["रपि"])
  , ("हरीः","हरीरपि",["अपि"])
  , ("हरेः","हरेरपि",["अपि"])
  , ("श्रीः","श्रीर्गता",["गता"])
  , ("गुरुः","गुरुर्देवः",["देवः"])
  , ("गुरुः","गुरुःसाक्षात्",["साक्षात्"])
  , ("निः","निरसः",["असः"])
  , ("निः","नीरसः",["रसः"])
  , ("नीः","नीरसः",["असः"])
  , ("सः","सपश्यति",["पश्यति"])
  , ("सः","सोऽपि",["अपि"])
  , ("एषः","एषगच्छति",["गच्छति"])
  , ("कः","कश्चित्",["चित्"])
  ]
-- "निः~निःष्फुरणीयः"
visargaDataNeg = [
    ("देवः","देवअपि",[])
  , ("देवाः","देवाप्रसीदन्तु",[])
  , ("देवः","देवर्गच्छति",[])
  , ("देवः","देवोपठति",[])
  , ("देवः","देवष्फल",[])
  , ("देवः","देवष्करः",[])
  , ("निः","निर्रसः",[])
  , ("नीः","निरसः",[])
  , ("सः","सअपि",[])
  , ("सः","सोगच्छति",[])
  ]
-- [true,["उत्","उन्मादः",["मादः"],["उद्मादः"]]]
halData = [
  ("तत्","तदारभ्य",["आरभ्य"])
  , ("तत्","तत्कालः",["कालः"])
  , ("उत्","उद्धारः",["धारः","हारः"])
  , ("उत्","उल्लेखः",["लेखः"]) 
  , ("उत्","उद्वेगः",["वेगः"])
  , ("उत्","उन्मादः",["मादः"])
  , ("उत्","उच्चारः",["चारः"])
  , ("उत्","उच्छक्तः",["छक्तः","शक्तः"])
  , ("उत्","उज्जयिनी",["जयिनी"])
  , ("उत्","उज्झम्पः",["झम्पः"])
  , ("उत्","उड्डयः",["डयः"])
  , ("उत्","उत्पातः",["पातः"])
  , ("उत्","उद्भूतः",["भूतः"])
  , ("उत्","उत्साहः",["साहः"])
--  , ("सम्","सञ्चारः",["चारः"])
  , ("सम्","समयः",["अयः"])
--  , ("सम्","सम्पर्कः",["पर्कः"])
  , ("सम्","संयमः",["यमः"])
--  , ("सम्","सन्ह्नवः",["ह्नवः"])
  , ("तत्","तत्",[""])  -- end
  , ("राज्","राज्ञः",["ञः","नः"]) -- we don't use it in parsing राज्ञः, it should be noted.
  , ("कस्मात्","कस्माच्चित्",["चित्"])
  , ("कस्मिन्","कस्मिंश्चित्",["चित्"])
  , ("कस्मिन्","कस्मिन्नपि",["अपि"])
  , ("कथम्","कथञ्चित्",["चित्"])
  ]
--
halDataNeg = [
  ("तत्","ततारभ्य",[])
  , ("उत्","उध्धारः",[])
  , ("उत्","उत्चारः",[])
  , ("उत्","उद्जयिनी",[])
  , ("उद्","उत्पातः",[])
  , ("सम्","सम्यक्",[])
  , ("सम्","सं",[])
  , ("सम्","सन्ह्वायः",[])
  ]

apteHalData =
  [ ("शरद्","शरत्कालः",["कालः"])
  , ("शरद्","शरद्वसन्तौ",["वसन्तौ"])
  , ("शरद्","शरज्ज्येष्ठौ",["ज्येष्ठौ"])
  , ("शरद्","शरच्चित्रम्",["चित्रम्"])
  , ("शरद्","शरद्धेमन्तौ",["हेमन्तौ"])
  , ("शरद्","शरच्छिशिरौ",["शिशिरौ"])
  , ("शरद्","शरन्नवरात्रम्",["नवरात्रम्"])
  , ("शरद्","शरल्लास्यम्",["लास्यम्"])
  , ("शरद्","शरन्माधुरी",["माधुरी"])
  , ("राजन्","राजपुरुषः",["पुरुषः"])
  , ("राजन्","राजेन्द्रः",["इन्द्रः"])
  , ("राजन्","राजमार्गः",["मार्गः"])
  , ("राजन्","राजमार्गः",["मार्गः"])
  , ("राजन्","राजच्छलम्",["छलम्"])
  , ("अनुष्टुभ्","अनुष्टुप्श्लोकः",["श्लोकः"])
  , ("अनुष्टुभ्","अनुष्टुब्रचना",["रचना"])
  , ("किम्","किंपुरुषः",["पुरुषः"])
  , ("अहम्","अहमिका",["इका"])
  , ("वाच्","वाग्झरी",["झरी"])
  , ("वणिज्","वणिग्वृत्तिः",["वृत्तिः"])
  , ("वणिज्","वणिक्पुरुषः",["पुरुषः"])
  , ("मनस्","मनस्तापः",["तापः"])
  , ("मनस्","मनःशान्तिः",["शान्तिः"])
  , ("मनस्","मनोऽभिलाषः",["अभिलाषः"])
  , ("पयस्","पयोधिः",["धिः"])
  , ("धनुस्","धनुर्वेदः",["वेदः"])
  , ("निस्","निश्चिन्तः",["चिन्तः"])
  , ("निस्","नीरसः",["रसः"])
  , ("निर्","नीरसः",["रसः"])
  , ("निस्","निष्फलः",["फलः"])
  , ("निर्","निष्फलः",["फलः"])
  , ("ज्योतिस्","ज्योतिष्पीठम्",["पीठम्"])
  , ("ज्योतिस्","ज्योतिष्करः",["करः"])  
  , ("पुनर्","पुनर्जन्म",["जन्म"])
  , ("पुनर्","पुनःपुनः",["पुनः"])
  , ("पुनर्","पुनश्चेतन",["चेतन"])
  , ("पुनर्","पुनश्चेतन",["चेतन"])
  , ("अन्तर्","अन्ताराज्य",["राज्य"])
  , ("अन्तर्","अन्ताराज्य",["राज्य"])
  , ("विद्वस्","विद्वत्पूर्ण",["पूर्ण"])
  , ("विद्वस्","विद्वल्लोकः",["लोकः"])
  , ("अनडुह्","अनडुज्जिह्वा",["जिह्वा"])
  , ("दिश्","दिग्विजयः",["विजयः"])
  , ("दिश्","दिङ्मूढः",["मूढः"])
  , ("दिश्","दिक्पालक",["पालक"])
  , ("ईदृश्","ईदृक्पत्रम्",["पत्रम्"])
  , ("विश्","विट्पतिः",["पतिः"])
  , ("विष्","विट्पतिः",["पतिः"])
  , ("षष्","षण्मुखः",["मुखः"])
  , ("षष्","षड्भुजः",["भुजः"])
  , ("परिव्राज्","परिव्राड्वर्यः",["वर्यः"])
  , ("विराज्","विराट्स्वरूपम्",["स्वरूपम्"])
  , ("अहस्","अहोरात्रम्",["रात्रम्"]) -- really, अहन्...
  , ("अहस्","अहस्करः",["करः"]) -- really, अहन्...
  , ("मेदस्","मेदस्पिण्डः",["पिण्डः"])
  , ("नमस्","नमस्कारः",["कारः"])
  , ("पयस्","पयस्कुंभः",["कुंभः"])
  , ("वयस्","वयस्कः",["कः"])
   ]

apteHalDataNeg =
  [ ("अहन्","अहर्निशम्",["निशम्"])
  ]
--[true,["देवः","देवारक्षति",["रक्षति"],["देवोरक्षति"]]]
sandhiTest t ds = do
  let datas = concat ds
  acts <- forM datas t
  let fails = filter fst acts
  putStrLn $ "Total tests: " ++ show (length acts) ++ "\nFailures: " ++ show (length fails)
  putStrLn "Failure details:"
  sequence $ printu <$> fails

testG sandhiF (purva, full, uttaras) = do
  let fulls = uniq $ sandhiF purva <$> uttaras
  return (fulls/=[full],(purva,full,uttaras,fulls))
  --[true,["अ","अआलयः",["आलयः"],["आलयः"]]] [true,["अ","अआलयः",["आलयः"],["आलयः"]]]
  
main = sandhiTest (testG sandhiPrint) [akData,ecData,visargaData,halData]

apteCompat (purva, _, _) = takeEnd' 2 purva `notElem` ["न्","म्","च्","ज्"]
apteMain = sandhiTest (testG sandhiAptePrint) [akData,ecData,visargaData,filter apteCompat halData,apteHalData]